<!DOCTYPE html>
<html lang="en" class="js flexbox flexboxlegacy canvas canvastext webgl no-touch geolocation postmessage websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers applicationcache svg inlinesvg smil svgclippaths">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta charset="utf-8" />
    <meta name="keywords" content="">

    <title>  Copy (27)</title>
    <link rel="shortcut icon" href="favicon.png" type="image/x-icon" />
    <link rel="stylesheet" href="assets/css/toc.css" />
    <link rel="stylesheet" href="assets/css/highlight.css" />
    <link rel="stylesheet" href="assets/css/prism.css" />
    <link rel="stylesheet" href="assets/css/prism-csdiff.css" />


    <link rel="stylesheet" href="assets/css/theme_firefly.css" />
    <link rel="stylesheet" href="assets/css/mermaid.css" />
</head>
<body class="markdown-body" role="document">

    <div class="wrapper">

        <div class="middle">

            <div class="container">

                <div class="content" role="navigation" aria-label="footer navigation">
                    <a id="previousButton" class="btn btn-neutral float-left" style="visibility:hidden">Previous</a> <a id="nextButton" class="btn btn-neutral float-right" style="visibility:hidden">Next</a>
                </div>
                <div class="content"><h1 id="copy-27">Copy (27)</h1>
<p>.</p>
<h1 id="this-is-the-second-env.web-demo">This is the second ENV.Web demo</h1>
<p>In this demo we'll create a fully updateable master detail screen, for orders and order details with selection lists and everything around it.</p>
<p>Let's start:</p>
<h1 id="creating-the-server-apis">Creating the Server Api's</h1>
<p>in the 'Controllers\DataApiController.cs', will add an api for <code>Orders</code>, <code>OrderDetails</code>, <code>Customers</code>, <code>Shippers</code> and <code>Products</code>:</p>
<pre data-line="7,8,9,10,11" class="language-csdiff line-numbers"><code>public class DataApiController : Controller
{
    static DataApi _dataApi = new DataApi();
    static DataApiController()
    {
        _dataApi.Register(typeof(Northwind.Models.Categories),true);
        _dataApi.Register(typeof(Northwind.Models.Orders));
        _dataApi.Register(typeof(Northwind.Models.Order_Details));
        _dataApi.Register(typeof(Northwind.Models.Customers));
        _dataApi.Register(typeof(Northwind.Models.Shippers));
        _dataApi.Register(typeof(Northwind.Models.Products));
    }
    // GET: DataApi
    public void Index(string name, string id = null)
    {
        _dataApi.ProcessRequest(name, id);
    }
} </code></pre>
<h3 id="build-and-go-to-the-browser-under-dataapi-well-see-all-the-added-apis">Build and go to the browser, under <code>dataApi/</code> we'll see all the added apis.</h3>
<p><img src="../2017-10-13_08h07_25.gif" alt="2017 10 13 08H07 25" /></p>
<h3 id="lets-rename-the-order_details-api-to-orderdetails">Let's rename the <code>order_details</code> api to <code>orderDetails</code>:</h3>
<pre data-line="4" class="language-csdiff line-numbers"><code>_dataApi.Register(typeof(Northwind.Models.Categories),true);
_dataApi.Register(typeof(Northwind.Models.Orders));
-_dataApi.Register(typeof(Northwind.Models.Order_Details));
_dataApi.Register("orderDetails",typeof(Northwind.Models.Order_Details));
_dataApi.Register(typeof(Northwind.Models.Customers));
_dataApi.Register(typeof(Northwind.Models.Shippers)); </code></pre>
<h1 id="creating-the-client-side">Creating the client side</h1>
<h2 id="add-a-new-angular-component-to-the-applciation">Add a new angular component to the applciation</h2>
<ol>
<li>Goto the <code>Scripts\App</code> folder</li>
<li>Add new item and use the <code>Angular2Component</code> template found in the <code>ENV.Web</code> folder. Call it <code>Orders.ts</code></li>
</ol>
<pre data-line="" class="language-csdiff line-numbers"><code>import { Component } from '@angular/core';
import * as utils from './lib/utils';
import * as models from './models';

@Component({
    template:`
&lt;h1&gt;Orders&lt;/h1&gt;
`
})
export class Orders  {

} </code></pre>
<ol start="3">
<li>Goto <code>Scripts\App\app.module.ts</code> and register the new component:</li>
</ol>
<pre data-line="4,10" class="language-csdiff line-numbers"><code>...
import { RouterModule, Routes } from '@angular/router';
import { Categories } from './Categories';
import { Orders } from './Orders';



var app = new utils.AppHelper();
app.Register(Categories);
app.Register(Orders);

... </code></pre>
<p>Open the Browser and you'll see a new Orders menu entry, click it and see the Orders component.
<img src="../2017-10-13_08h16_07.gif" alt="2017 10 13 08H16 07" /></p>
<h2 id="getting-the-rest-api-definitions-to-the-client-typescript-code">Getting the rest api definitions to the client typescript code</h2>
<p>Go to the <code>dataApi</code> help page and copy the TypeScript interfaces and classes for each api into the <code>Scripts\App\models.ts' file. *Do it for all the apis we need,</code>orders<code>,</code>orderDetails<code>,</code>customers<code>,</code>shippers<code>and</code>products`*
<img src="../2017-10-13_08h19_37.gif" alt="2017 10 13 08H19 37" /></p>
<p><code>Scripts\App\models.ts</code></p>
<pre data-line="12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90" class="language-csdiff line-numbers"><code>import * as utils from './lib/utils';
export class categories extends utils.DataSettings&lt;category&gt;{
    constructor(settings?: utils.IDataSettings&lt;category&gt;) {
        super('/dataapi/categories', settings);
    }
}
export interface category {
    id?: number;
    categoryName?: string;
    description?: string;
}
export class orders extends utils.DataSettings&lt;order&gt;{
     constructor(settings?: utils.IDataSettings&lt;order&gt;) {
         super('/dataapi/orders', settings);
     }
}
export interface order {
     id?: number;
     customerID?: string;
     employeeID?: number;
     orderDate?: string;
     requiredDate?: string;
     shippedDate?: string;
     shipVia?: number;
     freight?: number;
     shipName?: string;
     shipAddress?: string;
     shipCity?: string;
     shipRegion?: string;
     shipPostalCode?: string;
     shipCountry?: string;
}
export class orderDetails extends utils.DataSettings&lt;orderDetail&gt;{
     constructor(settings?: utils.IDataSettings&lt;orderDetail&gt;) {
         super('/dataapi/orderDetails', settings);
     }
}
export interface orderDetail {
     orderID?: number;
     productID?: number;
     unitPrice?: number;
     quantity?: number;
     discount?: number;
     id?: string;
}
export class customers extends utils.DataSettings&lt;customer&gt;{
     constructor(settings?: utils.IDataSettings&lt;customer&gt;) {
         super('/dataapi/customers', settings);
     }
}
export interface customer {
     id?: string;
     companyName?: string;
     contactName?: string;
     contactTitle?: string;
     address?: string;
     city?: string;
     region?: string;
     postalCode?: string;
     country?: string;
     phone?: string;
     fax?: string;
}
export class shippers extends utils.DataSettings&lt;shipper&gt;{
     constructor(settings?: utils.IDataSettings&lt;shipper&gt;) {
         super('/dataapi/shippers', settings);
     }
}
export interface shipper {
     id?: number;
     companyName?: string;
     phone?: string;
}
export class products extends utils.DataSettings&lt;product&gt;{
     constructor(settings?: utils.IDataSettings&lt;product&gt;) {
         super('/dataapi/products', settings);
     }
}
export interface product {
     id?: number;
     productName?: string;
     supplierID?: number;
     categoryID?: number;
     quantityPerUnit?: string;
     unitPrice?: number;
     unitsInStock?: number;
     unitsOnOrder?: number;
     reorderLevel?: number;
     discontinued?: boolean;
} </code></pre>
<h2 id="display-all-the-orders-on-a-data-grid">Display all the Orders on a data-grid</h2>
<p><code>Scripts\App\Orders.ts</code></p>
<pre data-line="8,12" class="language-csdiff line-numbers"><code>import { Component } from '@angular/core';
import * as utils from './lib/utils';
import * as models from './models';

@Component({
    template:`
  &lt;h1&gt;Orders&lt;/h1&gt;
  &lt;data-grid [settings]="orders"&gt;&lt;/data-grid&gt;
`
})
export class Orders  {
    orders = new models.orders();
} </code></pre>
<p>Here is the result:
<img src="../2017-10-13_08h29_23.png" alt="2017 10 13 08H29 23" /></p>
<p>By default the grid will display the first 5 columns on a grid, and all other columns below the grid in a <code>data-area</code></p>
<p>The grid is fully functional and the user can Sort, filter and page through the data, it can display millions of rows affectively as it only downloads the rows it needs to the browser.</p>
<h3 id="grid-functionality-demo">Grid functionality demo</h3>
<p><img src="../2017-10-13_08h32_41.gif" alt="2017 10 13 08H32 41" /></p>
<h2 id="design-the-view">Design the View</h2>
<p>You can visually design the view by adding <code>?design=y</code> to the url and then copy the result <code>typescript</code> code into the orders class.
<img src="../2017-10-13_08h38_37.gif" alt="2017 10 13 08H38 37" />
We'll make the following changes:</p>
<ol>
<li>Rename <code>id</code> column to be <code>Order Id</code> and make it <code>readonly</code></li>
<li>Change the <code>orderDate</code> column to be of input type <code>date</code></li>
<li>Remove the <code>EmployeeID</code> column</li>
</ol>
<p>We'll copy the code into our typescript code and run it.
It should look like this:
<code>Scripts\App\Orders.ts</code></p>
<pre data-line="3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20" class="language-csdiff line-numbers"><code>export class Orders  {
    orders = new models.orders(
        {
            columnSettings: [
                { key: "id", caption: "Order ID", readonly: true },
                { key: "customerID" },
                { key: "orderDate", inputType: "date" },
                { key: "requiredDate" },
                { key: "shippedDate" },
                { key: "shipVia" },
                { key: "freight" },
                { key: "shipName" },
                { key: "shipAddress" },
                { key: "shipCity" },
                { key: "shipRegion" },
                { key: "shipPostalCode" },
                { key: "shipCountry" },
            ]
        }
    );
} </code></pre>
<p><img src="../2017-10-13_08h47_16.png" alt="2017 10 13 08H47 16" /></p>
<h3 id="lets-make-some-more-changes">let's make some more changes:</h3>
<ol>
<li>We'll use the <code>numOfColumnsInGrid</code> setting to only show 4 columns</li>
<li>We'll move <code>shipVia</code> to be the 3rd column</li>
<li>we'll remove columns that we don't need (you can do it in the designer or the code)</li>
</ol>
<pre data-line="4,9" class="language-csdiff line-numbers"><code>export class Orders  {
    orders = new models.orders(
        {
            numOfColumnsInGrid:4,
            columnSettings: [
                { key: "id", caption: "Order ID", readonly: true },
                { key: "customerID" },
                { key: "orderDate", inputType: "date" },
                { key: "shipVia" },
                { key: "requiredDate" },
                { key: "shippedDate" },
-               { key: "shipVia" },
-               { key: "freight" },
-               { key: "shipName" },
                { key: "shipAddress" },
                { key: "shipCity" },
-               { key: "shipRegion" },
-               { key: "shipPostalCode" },
-               { key: "shipCountry" },
            ]
        }
    );
} </code></pre>
<ol start="4">
<li>We'll also change the <code>requiredDate</code> and <code>shippedDate</code> to be of type <code>date</code></li>
</ol>
<pre data-line="11,13" class="language-csdiff line-numbers"><code>export class Orders  {
    orders = new models.orders(
        {
            numOfColumnsInGrid:4,
            columnSettings: [
                { key: "id", caption: "Order ID", readonly: true },
                { key: "customerID" },
                { key: "orderDate", inputType: "date" },
                { key: "shipVia" },
-               { key: "requiredDate" },
                { key: "requiredDate", inputType:"date" },
-               { key: "shippedDate" },
                { key: "shippedDate" , inputType:"date" },
                { key: "shipAddress" },
                { key: "shipCity" },
            ]
        }
    );
} </code></pre>
<p>It should now look like this:
<img src="../2017-10-13_08h53_10.png" alt="2017 10 13 08H53 10" /></p>
<h2 id="lets-get-the-customer-name">Let's get the customer Name</h2>
<p>Add the customers member:</p>
<pre data-line="3" class="language-csdiff line-numbers"><code>...
export class Orders  {
    customers = new models.customers();
    orders = new models.orders(
        {
            numOfColumnsInGrid:4,
            columnSettings: [
                { key: "id", caption: "Order ID", readonly: true },
                { key: "customerID" },
... </code></pre>
<p>Get the value from customers:
<img src="../2017-10-13_09h08_32.gif" alt="2017 10 13 09H08 32" /></p>
<ol>
<li>we set the <code>getValue</code> of the <code>customerID</code> column with an <code>Arrow Function</code>.</li>
<li>This function receives a parameter of type <code>order</code>, the order for which we want to find the customer.</li>
<li>We then call the <code>lookup.get</code> function, and search for a customer who's <code>id</code> equals the <code>customerID</code> or the current <code>order</code> (we can filter on any column)</li>
<li>Then we return the <code>companyName</code> column.
Note how we have intellisense in every step of the way - that's <code>TypeScript</code></li>
</ol>
<pre data-line="11,12" class="language-csdiff line-numbers"><code>...
export class Orders  {
    customers = new models.customers();
    orders = new models.orders(
        {
            numOfColumnsInGrid:4,
            columnSettings: [
                { key: "id", caption: "Order ID", readonly: true },
                {
                    key: "customerID",
                    getValue: o =&gt;
                        this.customers.lookup.get({ id: o.customerID }).companyName
                },
                { key: "orderDate", inputType: "date" },
                { key: "shipVia" },
                { key: "requiredDate", inputType:"date" },
                { key: "shippedDate" , inputType:"date" },
                { key: "shipAddress" },
                { key: "shipCity" },
            ]
        }
    );
}
... </code></pre>
<p>Here is the result:
<img src="../2017-10-13_09h06_36.png" alt="2017 10 13 09H06 36" /></p>
<br /><hr />Help us improve, <a href="https://github.com/FireflyMigration/firefly-doc/blob/master//01-Development/02-Articles/Web-Development/01-Web Development Tutorial/ENV Web/99- - Copy (27).md" target="_blank">Edit this page on GitHub</a><br /> or email us at <a href="mailto:info@fireflymigration.com?Subject=Firefly%20Documentation%20Website" target="_top">info@fireflymigration.com</a></div><!-- .content -->
                
            </div><!-- .container-->
        
            <aside class="left-sidebar">
                <div class="wy-side-nav-search-ff">
                    <a href="" class="test">  <img src="assets/img/logo-big.png"></a>
                </div><div id="menuTree"</div>
            </aside><!-- .left-sidebar -->

            <aside class="right-sidebar"></aside><!-- .right-sidebar -->

        </div><!-- .middle-->



    </div>


    <script src="assets/js/mermaid.js"></script>
    <script src="assets/js/prism-start.js"></script>
    <script src="assets/js/prism-clike.js"></script>
    <script src="assets/js/prism-markup.js"></script>
    <script src="assets/js/prism-css.js"></script>
    <script src="assets/js/prism-javascript.js"></script>

    <script src="assets/js/prism-diff.js"></script>
    <script src="assets/js/prism-csdiff.js"></script>
    <script src="assets/js/prism-function.js"></script>

    <script src="assets/js/jquery-3.1.1.js"></script>
    
    
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-4806432-3', 'auto');
  ga('send', 'pageview');

    </script>
    <script src="assets/js/tree.js"></script>
    <script language="javascript">
        buildTree('menuTree', '--copy-(27).html', 'previousButton', 'nextButton');
    </script>
</body>
</html>