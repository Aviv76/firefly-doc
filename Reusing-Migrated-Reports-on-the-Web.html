<!DOCTYPE html>
<html lang="en" class="js flexbox flexboxlegacy canvas canvastext webgl no-touch geolocation postmessage websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers applicationcache svg inlinesvg smil svgclippaths">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta charset="utf-8" />
    <meta name="keywords" content="">

    <title>Reusing Migrated Reports on the Web</title>

    <link rel="stylesheet" href="assets/css/toc.css" />
    <link rel="stylesheet" href="assets/css/highlight.css" />
    <link rel="stylesheet" href="assets/css/prism.css" />
    <link rel="stylesheet" href="assets/css/prism-csdiff.css" />

    
    <link rel="stylesheet" href="assets/css/theme_firefly.css" />
    <link rel="stylesheet" href="assets/css/mermaid.css" />
</head>
<body class="markdown-body" role="document">

    <div class="wrapper">

           <div class="middle">

            <div class="container">

                <div class="content" role="navigation" aria-label="footer navigation">
                    <a id="previousButton" class="btn btn-neutral float-left" style="visibility:hidden">Previous</a> <a  id="nextButton"  class="btn btn-neutral float-right" style="visibility:hidden">Next</a>
                </div>
                <main class="content"><h1 id="reusing-migrated-reports-on-the-web">Reusing Migrated Reports on the Web</h1>
<p>I’m working now on new and interesting ways to reuse existing/migrated code in web projects.</p>
<p>This article is a part of a series of articles about reusing code from a migrated project in a web project.</p>
<p>To configure and setup an MVC application that reuses migrated code, see Setting up an MVC project that reuses migrated code – this article</p>
<p>Next I recommend you read the following articles in the following order:</p>
<ol>
<li>Creating my first MVC page</li>
<li>Using POCO Objects Based on Migrated Entities</li>
<li>Poco Creator–automatically create poco object based on entities, (T4 Templates)</li>
<li>Poco Creator, next step–extending the generated objects</li>
<li>Reusing Migrated Reports on the Web – this article
This time, my goal was to reuse reports that I already had in my application.</li>
</ol>
<p>For example, in the Northwind application, there is a print button, that prints the current Order.<br />
<img src="showorders_application1.png" alt="" /></p>
<p>When the Print button is clicked, it’ll open the Print Preview screen and show the following report.<br />
<img src="order_printing_preview.png" alt="" /></p>
<p>I want to reuse that report on the web.</p>
<p>To do that, I created a class that alters the existing PrinterWriter, so that when it’s set, it re-routs all printings to an in memory PDF printer.</p>
<p>I’ll show its implementation in a second, but first let’s see how to use it.</p>
<p>I’m using MVC, so all I needed to do is to add a “Print” method to my MVCController:<br />
<img src="actionresult_print.png" alt="" /></p>
<p>The first line,instantiates a new instance of the CapturePDFPrinting class (temporary name), which captures all printings and converts them into a PDF.</p>
<p>Then I called the existing (Migrated) class that prints the report. Note that I didn’t have to alter it in any way. Once it’s done, I’m returning an MVC.FileStreamResult with content type PDF.</p>
<p>This is the result in the browser:<br />
<img src="order_printing_preview_browser.png" alt="" /></p>
<p>That’s it.</p>
<p>For those of you who want to use it, these classes are included as part of a migration project, with the Northwind code sample or with your migrated code.</p>
<p>Now for the under the hood implementation, only read this if you really care about wiring:</p>
<p>First I needed to change the existing PDF printing to support printing to a Stream and not only to a File.</p>
<p>So I changed the _fileName member to be a factory that returns a Stream:<br />
<img src="compare_string_filename.png" alt="" /></p>
<p>Its usage now uses the StreamFactory instead of creating the stream on the spot:
<img src="compare_streamfactory.png" alt="" /></p>
<p>I have changed the constructor to receive a StreamFactory and to have an overload for the original implementation.</p>
<p>Then I have added the CapturePrinting class, and a ThreadStatic member to hold it when it’s used:<br />
<img src="CapturePDFPrinting.png" alt="" /></p>
<p>And finally I altered the CreateAlternativePrintJob class to use the capture class when it’s not null:<br />
<img src="compare_createalternativeprintjob.png" alt="" /></p>
<p>Now, only for the current thread, at the current time— every printing will print to an in-memory PDF printer, in which its results are returned immediately to the browser.</p>
</main><!-- .content -->
            </div><!-- .container-->

            <aside class="left-sidebar"><div class="wy-side-nav-search-ff">
    <a href="" class="test">  <img src="assets/img/logo-big.png"></a>
</div><div id="menuTree" style="height:100em"></div></aside><!-- .left-sidebar -->

            <aside class="right-sidebar">
                
            </aside><!-- .right-sidebar -->

        </div><!-- .middle-->

   

    </div>


    <script src="assets/js/mermaid.js"></script>
    <script src="assets/js/prism-start.js"></script>
    <script src="assets/js/prism-clike.js"></script>
    <script src="assets/js/prism-markup.js"></script>
    <script src="assets/js/prism-css.js"></script>
    <script src="assets/js/prism-javascript.js"></script>
    
    <script src="assets/js/prism-diff.js"></script>
    <script src="assets/js/prism-csdiff.js"></script>    
    <script src="assets/js/prism-function.js"></script>    
    
    <script src="assets/js/jquery-3.1.1.js"></script>
    <script src="assets/js/tree.js"></script>
    <script language="javascript">
        buildTree('menuTree', 'Reusing-Migrated-Reports-on-the-Web.html', 'previousButton', 'nextButton');
    </script>
</body>
</html>